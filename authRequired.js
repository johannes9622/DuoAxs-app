import jwt from 'jsonwebtoken'; export function authRequired(req,res,next){ try{ const hdr=req.headers.authorization||''; const tok=hdr.startsWith('Bearer ')?hdr.slice(7):null; if(!tok) return res.status(401).json({error:'Missing token'}); const payload=jwt.verify(tok, process.env.JWT_SECRET||'dev'); req.user=payload; next(); }catch(e){ return res.status(401).json({error:'Unauthorized'});} }